# Plan: 번역 기능 마무리 + 언어 선택 UX 단순화

## 목표
- 언어 선택 시 **페이지 전체 텍스트가 일관되게 번역된 것처럼 보이는 경험**을 제공한다.
- 현재처럼 일부만 번역되는 문제(제목만 번역, 설명/저자/출판사 혼재)를 줄인다.
- 우측 상단 언어 선택 UI를 단순화해 사용자가 빠르게 원하는 언어를 고를 수 있게 한다.

## 현재 문제 요약
1. 번역 데이터 소스가 불완전해 페이지 내 필드별 언어 일관성이 깨진다.
2. 실시간 번역/사전 번역 경계가 불명확해 응답 품질이 들쭉날쭉하다.
3. 언어 옵션이 많아 보이고, 실제 사용자에게 필요한 언어 우선순위가 반영되지 않는다.
4. 일부 KR 데이터는 HTML 정제 이슈까지 겹쳐 번역 품질 체감이 더 떨어진다.

---

## 제안 아키텍처 (MVP 기준)

### 1) 번역 전략: "사전 번역 + 폴백" 하이브리드
- 기본: 스크래핑 후 백엔드에서 사전 번역을 저장(캐시/DB).
- 폴백: 번역 미완료 시 원문 노출 + `translationStatus` 메타(`ready|partial|source`) 반환.
- UI: `partial/source` 상태에서 "원문 포함" 배지 또는 토스트로 사용자 기대치 관리.

### 2) 번역 대상 필드 우선순위
- P0(필수): `title`, `description`
- P1(권장): `authorName`, `publisher`, `category`
- P2(선택): 배지/버튼/빈 상태 문구 등 UI 문자열

### 3) 번역 엔진(무료 우선)
- 1순위: LibreTranslate 자체 호스팅(비용 0원 API, 인프라 비용만 발생)
- 2순위: 초기 개발용 공개 무료 엔드포인트(프로덕션은 비권장)
- 공통: provider 인터페이스 분리(`translate(text, from, to)`)로 교체 가능 구조 유지

### 4) 데이터 품질 가드레일
- 번역 전 HTML sanitize(특히 KR 설명 `<br>`, `<b>` 등) → 번역 → 저장 순서 고정
- 동일 문장 중복 번역 방지 캐시
- 길이 제한/실패 재시도/백오프
- 고유명사(인명·출판사)는 규칙 기반 원문 유지 옵션 제공

---

## 언어 선택 UX 개선안

### 현재 문제
- 언어가 많아 보이고 선택 비용이 큼.
- 사용 빈도 높은 언어를 빠르게 고를 수 없음.

### 개선안
1. **Top 4 고정 + 더보기**
   - 기본 노출: `한국어`, `English`, `日本語`, `中文`
   - 나머지 언어는 `More` 드롭다운으로 숨김
2. **국가 기반 추천 우선 정렬**
   - 선택한 국가 탭에 따라 추천 언어 순서를 변경
   - 예: KR 탭에서 한국어 1순위, JP 탭에서 일본어 1순위
3. **최근 선택 언어 pinning**
   - 최근 1개 언어를 첫 위치에 고정
4. **자동 감지 최소화**
   - 첫 방문 1회만 브라우저 언어를 제안하고, 이후는 사용자 선택 고정
5. **용어 통일**
   - 언어명은 자국어 표기 우선(예: `한국어`, `English`, `日本語`, `中文`)

---

## 구현 단계(2주 MVP)

### Phase 1 (2~3일): 모델/응답 계약 정리
- API 응답에 `translationStatus` 추가
- 필드별 번역 우선순위 확정 및 타입 반영
- 언어 코드 표준화(`ko|en|ja|zh` 우선)

### Phase 2 (3~4일): 번역 서비스 계층
- `translation service` 모듈 추가(provider 인터페이스)
- LibreTranslate 연동 + 실패 처리(타임아웃/재시도)
- 텍스트 캐시 키 규칙 정의(`hash(text)+from+to`)

### Phase 3 (2~3일): 스크래퍼/저장 파이프라인
- sanitize → translate → persist 순서 적용
- 백필 작업(기존 데이터 재번역 배치)
- 모니터링 로그(성공률/실패율/지연)

### Phase 4 (2~3일): 프론트 언어 선택 UX 개편
- Top4 + More 컴포넌트로 교체
- 최근 선택 pinning + 국가별 추천 정렬
- `translationStatus` 기반 안내 UI 추가

### Phase 5 (1~2일): QA/릴리즈
- 다국어 스냅샷 테스트(목록/상세)
- 번역 누락/부분 번역 케이스 수동 점검
- 점진 배포(국가별/트래픽 비율)

---

## 성공 지표(KPI)
- 언어 전환 후 "부분 번역" 노출 비율 50% 이상 감소
- 상세 페이지 번역 일관성(필수 필드 P0) 95% 이상
- 언어 변경 후 첫 콘텐츠 표시 시간(체감) 1.5초 이내
- 번역 실패율 3% 이하

## 리스크 및 대응
- 번역 품질 편차: 고유명사 번역 제외 규칙 + 예외 사전
- 비용/성능: 사전 번역 캐시, 배치 처리, TTL 조정
- 장애 대응: provider down 시 원문 폴백 + 상태 표기

## 즉시 착수 권장 작업 (이번 스프린트)
1. `translationStatus` 계약 추가
2. LibreTranslate PoC 연결
3. 언어 선택 UI를 Top4 + More 구조로 축소
4. KR 설명 sanitize/번역 순서 강제(회귀 테스트 포함)
